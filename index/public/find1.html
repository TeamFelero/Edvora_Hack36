<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find Nearby Educational Institutions</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>

<body>
  <div id="controls" class="flex flex-wrap justify-around gap-6 p-6 bg-white border-b border-gray-200 shadow-lg rounded-lg max-w-[1000px] mx-auto mt-6">
    <label for="cityInput" class="sr-only">City Name</label>
    <input type="text" id="cityInput" class="px-5 py-3 border border-gray-300 rounded-lg text-base focus:outline-none focus:border-blue-500 shadow-sm w-64 md:w-70" placeholder="Enter city name" />
    
    <select id="typeSelect" class="px-5 py-3 border border-gray-300 rounded-lg text-base focus:outline-none focus:border-blue-500 shadow-sm w-64 md:w-70">
      <option value="college">College</option>
      <option value="university">University</option>
    </select>
    
    <button onclick="searchByCity()" class="px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg w-full sm:w-auto">Search</button>
    
    <button onclick="searchNearby()" class="px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg w-full sm:w-auto">College Near Me</button>
  </div>

  <div id="cityInfo" class="text-center mt-8 p-6 bg-white mx-auto w-full max-w-3xl rounded-xl shadow-xl">
    <h3 class="text-xl font-semibold text-gray-800 mb-3">City Information</h3>
    <p class="text-base text-gray-600">Here will be the information about the city and educational institutions nearby.</p>
  </div>

  <div id="institutionInfo" class="text-center mt-8 p-6 bg-white mx-auto max-w-[1000px] max-w-3xl rounded-xl shadow-xl">
    <h3 class="text-xl font-semibold text-gray-800 mb-3">MNNIT</h3>
    <h3 class="text-xl font-semibold text-gray-800 mb-3">Prayagraj UttarPradesh-211004</h3>
  </div>
  
  
  
  <div id="map" class="h-[500px] w-full max-w-[1000px] mx-auto mt-8 rounded-xl shadow-xl bg-gray-100"></div>
  


  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    let map;
    let resultsLayer;

    async function searchByCity() {
      const city = document.getElementById("cityInput").value.trim();
      const type = document.getElementById("typeSelect").value;

      if (!city) {
        alert("Please enter a city name.");
        return;
      }

      const geoUrl = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(city)}`;
      const geoRes = await fetch(geoUrl);
      const geoData = await geoRes.json();

      if (!geoData || geoData.length === 0) {
        alert("City not found.");
        return;
      }

      const cityData = geoData[0];
      const lat = parseFloat(cityData.lat);
      const lon = parseFloat(cityData.lon);
      const displayName = cityData.display_name;
      const typeName = cityData.type || "unknown";
      const address = cityData.address || {};
      const region = address.state || address.region || address.county || "Unknown Region";
      const country = address.country || "Unknown Country";

      document.getElementById("cityInfo").innerHTML = `
        <h3>üåÜ ${displayName}</h3>
        <p>
          <strong>Type:</strong> ${typeName.charAt(0).toUpperCase() + typeName.slice(1)}<br>
          <strong>Region:</strong> ${region}<br>
          <strong>Country:</strong> ${country}<br>
          <strong>Coordinates:</strong> ${lat.toFixed(4)}, ${lon.toFixed(4)}
        </p>
      `;

      updateMapAndMarkers(lat, lon, type);
    }

    async function searchNearby() {
      const type = document.getElementById("typeSelect").value;

      if (!navigator.geolocation) {
        alert("Geolocation is not supported by your browser.");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async position => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const accuracy = position.coords.accuracy;

          console.log("Accuracy: ", accuracy);

          const reverseUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`;
          const reverseRes = await fetch(reverseUrl);
          const reverseData = await reverseRes.json();

          const address = reverseData.address || {};
          const displayName = reverseData.display_name || "Your Location";
          const region = address.state || address.region || address.county || "Unknown Region";
          const country = address.country || "Unknown Country";

          document.getElementById("cityInfo").innerHTML = `
            <h3>üìç You are near: ${displayName}</h3>
            <p>
              <strong>Region:</strong> ${region}<br>
              <strong>Country:</strong> ${country}<br>
              <strong>Coordinates:</strong> ${lat.toFixed(4)}, ${lon.toFixed(4)}
            </p>
          `;

          updateMapAndMarkers(lat, lon, type);
        },
        error => {
          alert("Unable to retrieve your location.");
        },
        {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        }
      );
    }

    async function updateMapAndMarkers(lat, lon, type) {
      if (!map) {
        map = L.map('map').setView([lat, lon], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
      } else {
        map.setView([lat, lon], 13);
        if (resultsLayer) resultsLayer.clearLayers();
      }

      const radius = 5000;
      const query = `
        [out:json];
        (
          node["amenity"="${type}"](around:${radius},${lat},${lon});
          way["amenity"="${type}"](around:${radius},${lat},${lon});
          relation["amenity"="${type}"](around:${radius},${lat},${lon});
        );
        out center;
      `;
      const overpassUrl = "https://overpass-api.de/api/interpreter?data=" + encodeURIComponent(query);
      const res = await fetch(overpassUrl);
      const data = await res.json();

      const elements = data.elements;
      const markers = [];

      if (elements.length === 0) {
        alert("No institutions found nearby.");
        return;
      }

      elements.forEach(el => {
        const elLat = el.lat || el.center?.lat;
        const elLon = el.lon || el.center?.lon;
        if (elLat && elLon) {
          const tags = el.tags || {};
          const name = tags.name || "Unnamed";
          const operator = tags.operator || "Unknown Operator";
          const popupContent = `
            <b>${name}</b><br>
            Type: ${type}<br>
            Operator: ${operator}
          `;
          markers.push(L.marker([elLat, elLon]).bindPopup(popupContent));
        }
      });

      resultsLayer = L.layerGroup(markers).addTo(map);
    }
  </script>

</body>

</html>
